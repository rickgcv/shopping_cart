sap.ui.define(["sap/ui/test/Opa5","sap/ui/test/actions/Press","./Common","sap/ui/test/actions/EnterText","sap/ui/test/matchers/AggregationEmpty","sap/ui/test/matchers/AggregationFilled","sap/ui/test/matchers/PropertyStrictEquals","sap/ui/test/matchers/Ancestor"],function(e,t,i,s,r,n,o,a){"use strict";var u="Master",c="*#-Q@@||";e.createPageObjects({onTheMasterPage:{baseClass:i,actions:{iSortTheListOnName:function(){return this.iChooseASorter("sortButton","Sort By <Name>")},iSortTheListOnUnitNumber:function(){return this.iChooseASorter("sortButton","Sort By <Price>")},iFilterTheListOnUnitNumber:function(){return this.iChooseASorter("filterButton","<Price>","<100 <CurrencyCode>")},iGroupTheList:function(){return this.iChooseASorter("groupButton","<Price> Group")},iRemoveListGrouping:function(){return this.iChooseASorter("groupButton","None")},iOpenViewSettingsDialog:function(){return this.waitFor({id:"filterButton",viewName:u,actions:new t,errorMessage:"Did not find the 'filter' button."})},iPressOKInViewSelectionDialog:function(){return this.iPressOKButtonInDialog("Did not find the ViewSettingDialog's 'OK' button.")},iPressResetInViewSelectionDialog:function(){return this.waitFor({searchOpenDialogs:true,controlType:"sap.m.Button",matchers:new o({name:"text",value:"Reset"}),actions:new t,errorMessage:"Did not find the ViewSettingDialog's 'Reset' button."})},iRememberTheSelectedItem:function(){return this.waitFor({id:"list",viewName:u,matchers:function(e){return e.getSelectedItem()},success:function(e){this.iRememberTheListItem(e)},errorMessage:"The list does not have a selected item so nothing can be remembered"})},iChooseASorter:function(e,i,s){return this.waitFor({id:e,viewName:u,actions:new t,success:function(){this.waitFor({controlType:"sap.m.StandardListItem",matchers:new o({name:"title",value:i}),searchOpenDialogs:true,actions:new t,success:function(){if(s){return this.waitFor({controlType:"sap.m.StandardListItem",matchers:new o({name:"title",value:s}),searchOpenDialogs:true,actions:new t,success:function(){return this.iPressOKButtonInDialog("The ok button in the dialog was not found and could not be pressed")},errorMessage:"Did not find the"+s+"in"+i})}else{return this.iPressOKButtonInDialog("The ok button in the dialog was not found and could not be pressed")}},errorMessage:"Did not find the"+i+" element in select"})},errorMessage:"Did not find the "+e+" select"})},iPressOKButtonInDialog:function(e){return this.waitFor({controlType:"sap.m.Button",matchers:new o({name:"text",value:"OK"}),searchOpenDialogs:true,actions:new t,errorMessage:e})},iRememberTheIdOfListItemAtPosition:function(e){return this.waitFor({id:"list",viewName:u,matchers:function(t){return t.getItems()[e]},success:function(e){this.iRememberTheListItem(e)},errorMessage:"The list does not have an item at the index "+e})},iRememberAnIdOfAnObjectThatsNotInTheList:function(){return this.waitFor({id:"list",viewName:u,matchers:new n({name:"items"}),success:function(e){var t=this.getEntitySet("ProductSet");var i=t.filter(function(t){return!e.getItems().some(function(e){return e.getBindingContext().getProperty("ProductID")===t.ProductID})});var s;if(i.length){s=i[0].ProductID}else{s=t[t.length-1].ProductID}var r=this.getContext().currentItem;r.bindingPath="/"+e.getModel().createKey("ProductSet",{ProductID:s});r.id=s},errorMessage:"The master list with id 'list' cannot be found"})},iPressOnTheObjectAtPosition:function(e){return this.waitFor({id:"list",viewName:u,matchers:function(t){return t.getItems()[e]},actions:new t,errorMessage:"List 'list' in view '"+u+"' does not contain an ObjectListItem at position '"+e+"'"})},iSearchForTheFirstObject:function(){return this.waitFor({id:"list",viewName:u,matchers:new n({name:"items"}),success:function(e){var t=e.getItems()[0].getTitle();return this.iSearchForValue(t)},errorMessage:"Did not find list items while trying to search for the first item."})},iSearchForValue:function(e){return this.waitFor({id:"searchField",viewName:u,actions:[new s({text:e}),new t],errorMessage:"Failed to find search field in Master view.'"})},iClearTheSearch:function(){return this.waitFor({id:"searchField",viewName:u,actions:new t({idSuffix:"reset"}),errorMessage:"Failed to find search field in Master view.'"})},iSearchForSomethingWithNoResults:function(){return this.iSearchForValue(c)},iRememberTheListItem:function(e){var t=e.getBindingContext();this.getContext().currentItem={bindingPath:t.getPath(),id:t.getProperty("ProductID"),title:t.getProperty("Name")}}},assertions:{theListShouldContainAGroupHeader:function(){return this.waitFor({controlType:"sap.m.GroupHeaderListItem",viewName:u,success:function(){e.assert.ok(true,"Master list is grouped")},errorMessage:"Master list is not grouped"})},theListShouldContainOnlyFormattedUnitNumbers:function(){return this.theUnitNumbersShouldHaveTwoDecimals("sap.m.ObjectListItem",u,"Numbers in ObjectListItems numbers are properly formatted","List has no entries which can be checked for their formatting")},theListHeaderDisplaysZeroHits:function(){return this.waitFor({viewName:u,id:"masterPageTitle",matchers:new o({name:"text",value:"<ProductSet> (0)"}),success:function(){e.assert.ok(true,"The list header displays zero hits")},errorMessage:"The list header still has items"})},theListHasEntries:function(){return this.waitFor({viewName:u,id:"list",matchers:new n({name:"items"}),success:function(){e.assert.ok(true,"The list has items")},errorMessage:"The list had no items"})},theListShouldNotContainGroupHeaders:function(){return this.waitFor({viewName:u,id:"list",matchers:function(e){return!e.getItems().some(function(e){return e.getMetadata().getName()==="sap.m.GroupHeaderListItem"})},success:function(){e.assert.ok(true,"Master list does not contain a group header although grouping has been removed.")},errorMessage:"Master list still contains a group header although grouping has been removed."})},theListShouldBeFilteredOnUnitNumber:function(){return this.theListShouldBeFilteredOnFieldUsingComparator("Price",100)},theListShouldBeSortedAscendingOnUnitNumber:function(){return this.theListShouldBeSortedAscendingOnField("Price")},theListShouldBeSortedAscendingOnName:function(){return this.theListShouldBeSortedAscendingOnField("Name")},theListShouldBeFilteredOnFieldUsingComparator:function(t,i){return this.waitFor({viewName:u,id:"list",matchers:function(e){return e.getItems().every(function(e){if(!e.getBindingContext()){return false}else{var s=e.getBindingContext().getProperty(t);return s<=i}})},success:function(){e.assert.ok(true,"Master list has been filtered correctly for field '"+t+"'.")},errorMessage:"Master list has not been filtered correctly for field '"+t+"'."})},iShouldSeeTheList:function(){return this.waitFor({id:"list",viewName:u,success:function(t){e.assert.ok(t,"Found the object List")},errorMessage:"Can't see the master list."})},theListShowsOnlyObjectsWithTheSearchStringInTheirTitle:function(){this.waitFor({id:"list",viewName:u,matchers:new n({name:"items"}),check:function(e){var t=e.getItems()[0].getTitle();var i=e.getItems().every(function(e){return e.getTitle().indexOf(t)!==-1});return i},success:function(){e.assert.ok(true,"Every item did contain the title")},errorMessage:"The list did not have items"})},theListShouldHaveAllEntries:function(){return this.waitFor({id:"list",viewName:u,success:function(t){var i=this.getEntitySet("ProductSet");var s=Math.min(t.getGrowingThreshold(),i.length);e.assert.strictEqual(t.getItems().length,s,"The growing list displays all items")},errorMessage:"List does not display all entries."})},iShouldSeeTheNoDataTextForNoSearchResults:function(){return this.waitFor({id:"list",viewName:u,matchers:new r({name:"items"}),success:function(t){e.assert.strictEqual(t.getNoDataText(),t.getModel("i18n").getProperty("masterListNoDataWithFilterOrSearchText"),"the list should show the no data text for search and filter")},errorMessage:"list does not show the no data text for search and filter"})},theHeaderShouldDisplayAllEntries:function(){return this.waitFor({id:"list",viewName:u,success:function(t){var i=t.getBinding("items").getLength();return this.waitFor({id:"masterPageTitle",viewName:u,matchers:new o({name:"text",value:"<ProductSet> ("+i+")"}),success:function(){e.assert.ok(true,"The master page header displays "+i+" items")},errorMessage:"The  master page header does not display "+i+" items."})},errorMessage:"Header does not display the number of items in the list"})},theListShouldHaveNoSelection:function(){return this.waitFor({id:"list",viewName:u,matchers:function(e){return!e.getSelectedItem()},success:function(t){e.assert.strictEqual(t.getSelectedItems().length,0,"The list selection is removed")},errorMessage:"List selection was not removed"})},theRememberedListItemShouldBeSelected:function(){return this.waitFor({id:"list",viewName:u,matchers:function(e){return e.getSelectedItem()},success:function(t){e.assert.strictEqual(t.getTitle(),this.getContext().currentItem.title,"The list selection is incorrect.\nHint: If the master list shows integer numbers, use toString function to convert the second parameter to string")},errorMessage:"The list has no selection"})},theListShouldBeSortedAscendingOnField:function(t){return this.waitFor({viewName:u,id:"list",matchers:function(e){var i=null;return e.getItems().every(function(e){if(!e.getBindingContext()){return false}var s=e.getBindingContext().getProperty(t);if(!s){return false}if(!i||s>=i){i=s;return true}else{return false}})},success:function(){e.assert.ok(true,"Master list has been sorted correctly for field '"+t+"'.")},errorMessage:"Master list has not been sorted correctly for field '"+t+"'."})}}}})});